name: build
on: [push, pull_request]
jobs:
    windows:
        runs-on: windows-latest
        steps:
          - uses: actions/checkout@v4

          - uses: actions/checkout@v4
            with:
              repository: libsdl-org/SDL
              path: SDL
          
          - uses: microsoft/setup-msbuild@v2

          - run: ls

          - run: MSBuild.exe "SDL\VisualC\SDL\SDL.vcxproj" /p:Configuration=Release /p:Platform=x64

          - run: mkdir output
            shell: cmd

          - run: copy /Y SDL\VisualC\SDL\x64\Release\SDL3.dll output
            shell: cmd
          
          - uses: actions/upload-artifact@v4
            with:
              name: SDL3-Windows
              path: output
              
    linux:
        runs-on: ubuntu-latest
        steps:
          - uses: actions/checkout@v4

          - uses: actions/checkout@v4
            with:
              repository: libsdl-org/SDL
              path: SDL

          - uses: actions/setup-java@v4
            with:
              java-version: '17'
              distribution: 'temurin'
        
          - uses: android-actions/setup-android@v3

          - run: 'sudo apt update'

          - run: 'sudo apt install git build-essential git make pkg-config cmake ninja-build gnome-desktop-testing libasound2-dev libpulse-dev libaudio-dev libjack-dev libsndio-dev libx11-dev libxext-dev libxrandr-dev libxcursor-dev libxfixes-dev libxi-dev libxss-dev libxtst-dev libxkbcommon-dev libdrm-dev libgbm-dev libgl1-mesa-dev libgles2-mesa-dev libegl1-mesa-dev libdbus-1-dev libibus-1.0-dev libudev-dev libpipewire-0.3-dev libwayland-dev libdecor-0-dev liburing-dev'

          - run: mkdir output
          
          - run: mkdir output/android
          
          - run: mkdir output/linux
            
          - run: 'cmake -DCMAKE_INSTALL_PREFIX:String="Sdk" -B build -DCMAKE_BUILD_TYPE=Release -S SDL -G "Unix Makefiles"'
          
          - run: 'make'
            working-directory: 'build'

          - run: cp build/libSDL3.so output/linux
          
          - run: 'sh androidbuildlibs.sh'
            working-directory: 'SDL'

          - run: cp -R SDL output/android
          
          - uses: actions/upload-artifact@v4
            with:
              name: SDL3-LinuxAndroid
              path: output
